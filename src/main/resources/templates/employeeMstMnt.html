<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Cache-Control" content="no-cache">
<meta http-equiv="Expires" content="Thu, 01 Dec 1994 16:00:00 GMT">
<title>社員マスタメンテナンス画面</title>
<link rel="stylesheet" media="all" th:href="@{/css/common.css}" />
<script type="text/javascript" th:src="@{/js/common.js}"></script>
<script type="text/javascript" th:src="@{/js/message.js}"></script>
<script type="text/javascript" th:src="@{/js/checkCommon.js}"></script>
<script type="text/javascript">
	/**
	 * チェックボックスがチェックされたら true、されていなければ false
	 * param index 対象行番号
	 */
	function checkDeleteFlg(index) {
		var deleteEmployeeId = document.forms[0].elements.deleteEmployeeId;
		var isCheck = false;

		if (deleteEmployeeId.length > 1) {
			isCheck = document.forms[0].elements.deleteEmployeeId[index].checked;
		} else {
			isCheck = deleteEmployeeId.checked;
		}

		document.forms[0].elements.document
				.getElementById('employeeMstMntBeanList[' + index
						+ '].deleteFlg').value = isCheck;
	}

	/**
	 * 新規登録画面へ
	 */
	function employeeMstMntRegisterInit() {
		document.forms[0].action = "/kikin-for-Struts/employeeMstMntRegisterInit.do";
		document.forms[0].submit();
	}

	/**
	 * 更新処理を行う
	 */
	function employeeMstMntUpdate() {
		// 一覧のサイズ
		var row = document.querySelectorAll(".employeeMntList")
		var listSize = row.length;

		// パスワードエラーメッセージ 修正　久野
		var newpasswordErrorMsg = '';
		// 社員名エラーメッセージ　追記　長谷川
		var employeeNameErrorMsg = '';
		// 社員名カナエラーメッセージ
		var employeeNameKanaErrorMsg = '';
		var errorMsg = '';

		with (document.forms['mntform'].elements) {
			for (var i = 0; i < listSize; i++) {
				// パスワードを取得する。
				var password = document.getElementById('password_' + i).value;
				
				//パスワードが更新されていた場合の処理　追記　久野
				 var newpassword = document.getElementById('newpassword_' + i).value;
				    // newpassword が空でなく "●●●●●●" でなければ更新
				    if (newpassword && newpassword !== "●●●●●●") {
				        document.getElementById('password_' + i).value = newpassword;
				    }
				
				// 社員名を取得する。　追記　長谷川
				var employeeName = document.getElementById('employeeName_' + i).value;
				// 社員名カナを取得する。
				var employeeNameKana = document
						.getElementById('employeeNameKana_' + i).value;

				// 背景色をクリアする
				document.getElementById('password_' + i).style.backgroundColor = 'white';
				document.getElementById('employeeName_' + i).style.backgroundColor = 'white'; //追記　長谷川
				document.getElementById('employeeNameKana_' + i).style.backgroundColor = 'white';

				// パスワードチェック 修正(久野)
				if (!newpasswordErrorMsg) {
					if (!checkRequired(newpassword)) {
						var strArr = [ 'パスワード' ];
						newpasswordErrorMsg = getMessage('E-MSG-000001', strArr);
						document.getElementById('newpassword_' + i).style.backgroundColor = 'red';
					}
				}

				//　社員名チェック 追記　長谷川
				if (!employeeNameErrorMsg) {
					if (!checkRequired(employeeName)) {
						var strArr = [ '社員名' ];
						employeeNameErrorMsg　= getMessage('E-MSG-000001', strArr);
						document.getElementById('employeeName_' + i).style.backgroundColor = 'red';
					}
				}
				// 社員名カナチェック
				if (!employeeNameKanaErrorMsg) {
					if (!checkHalfWidthKana(employeeNameKana)) {
						var strArr = [ '社員名カナ' ];
						employeeNameKanaErrorMsg = getMessage('E-MSG-000003',
								strArr);
						document.getElementById('employeeNameKana_' + i).style.backgroundColor = 'red';
					}
					//かな空白チェック追記　長谷川
					if (!checkRequired(employeeNameKana)) {
						var strArr = [ '社員名カナ' ];
						employeeNameKanaErrorMsg = getMessage('E-MSG-000001',
								strArr);
						document.getElementById('employeeNameKana_' + i).style.backgroundColor = 'red';
					}
				}

				if (newpasswordErrorMsg && employeeNameKanaErrorMsg) {
					// パスワード 、社員名カナが共にエラーの場合
					break;
				}
			}
		}
		// エラーメッセージ
		errorMsg = newpasswordErrorMsg + employeeNameErrorMsg + employeeNameKanaErrorMsg;// employeeNameErrorMsg追記　長谷川

		if (errorMsg) {
			alert(errorMsg);
			// エラー
			return false;
		}

		document.forms['mntform'].submit();
	}
</script>
</head>

<body>
	<div th:each="entry : ${dataMap}">
		<h2 th:text="${entry.key}"></h2>
		<ul>
			<li th:each="dto : ${entry.value}"><span th:text="${dto.value}"></span>
			</li>
		</ul>
	</div>
	<div id="wrapper">
		<div id="header">
			<table class="full-width">
				<tr>
					<td id="headLeft">
						<form action="/kikin/menu" method="post">
							<input value="戻る" type="submit" class="smallButton" />
						</form>
					</td>
					<td id="headCenter">社員マスタメンテナンス</td>
					<td id="headRight"><input value="ログアウト" type="button"
						class="smallButton" onclick="logout()" /></td>
				</tr>
			</table>
		</div>
		<div id="businessBody" style="overflow-x: hidden;">
			<form id="mntform" action="/kikin/employeeMstMnt/update"
				method="post" th:object="${employeeMstMntForm}">
				<table class="overflowFixed">
					<thead style="display: block; position: sticky;">
						<tr class="tableHeader">
							<td width="200px" align="center">社員ＩＤ</td>
							<td width="200px" align="center">パスワード</td>
							<td width="200px" align="center">社員名</td>
							<td width="200px" align="center">社員名カナ</td>
							<td width="100px" align="center">権限</td>
							<td width="100px" align="center">削除</td>
						</tr>
					</thead>
					<tbody class="tableBody"
						style="display: block; overflow-x: hidden; overflow-y: scroll; height: 440px; scrollbar-gutter: stable;">
						<tr
							th:each="item, itemStat : ${employeeMstMntForm.employeeMstMntBeanList}"
							class="employeeMntList">
							<td style="width: 200px; text-align: center;"><span
								th:text="*{employeeMstMntBeanList[__${itemStat.index}__].employeeId}"></span>
								<input type="hidden"
								th:field="*{employeeMstMntBeanList[__${itemStat.index}__].employeeId}"
								th:id="'employeeId_' + ${itemStat.index}" size="20"
								readonly="readonly" /></td>
							<td style="width: 200px; text-align: center;">
							<!-- パスワード処理　修正(久野) -->
							<input type="hidden"
								th:field="*{employeeMstMntBeanList[__${itemStat.index}__].password}"
								th:id="'password_' + ${itemStat.index}" size="10" maxlength="6" />
								<input type="password" th:id="'newpassword_' + ${itemStat.index}" th:name="'newpassword_' + ${itemStat.index}" value="●●●●●●" />
								</td>
							<td style="width: 200px; text-align: center;"><input
								type="text"
								th:field="*{employeeMstMntBeanList[__${itemStat.index}__].employeeName}"
								th:id="'employeeName_' + ${itemStat.index}" size="20"
								maxlength="10" /></td>
							<td style="width: 200px; text-align: center;"><input
								type="text"
								th:field="*{employeeMstMntBeanList[__${itemStat.index}__].employeeNameKana}"
								th:id="'employeeNameKana_' + ${itemStat.index}" size="20"
								maxlength="10" /></td>
							<td style="width: 100px; text-align: center;"><select
								th:field="*{employeeMstMntBeanList[__${itemStat.index}__].AuthorityId}"
								style="width: 80%;"><!-- width:100px→80%に修正（久野) -->
									<option value="01" th:selected="${item.AuthorityId == '01'}">管理者</option>
									<option value="02" th:selected="${item.AuthorityId == '02'}">一般</option>
							</select></td>
							<td style="width: 100px; text-align: center;"><input
								type="checkbox"
								th:field="*{employeeMstMntBeanList[__${itemStat.index}__].deleteFlg}" />
							</td>
						</tr>
					</tbody>
				</table>
			</form>
		</div>
		<br>
		<br>
		<div id="footer">
			<table style="width: 100%;"><!--style="width: 100%;追加　瀬口  -->
				<tr>
					<td id="footLeft"></td>
					<td id="footCenter"></td>
					<td id="footRight"><input value="新規登録" name="button"
						type="button" class="smallButton"
						onclick="location.href='/kikin/employeeMstMnt/regist'" /> <input
						value="更新" name="button" type="button" class="smallButton"
						onclick="employeeMstMntUpdate()" /></td>
				</tr>
			</table>
		</div>
	</div>
</body>

</html>