<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Cache-Control" content="no-cache">
<meta http equiv="Expires" content="Thu, 01 Dec 1994 16:00:00 GMT">
<title>勤怠システム</title>
<link rel="stylesheet" media="all" th:href="@{/css/common.css}" />
<link rel="stylesheet" media="all" th:href="@{/css/home.css}" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link
	href="https://fonts.googleapis.com/css2?family=Share+Tech&display=swap"
	rel="stylesheet">
<script type="text/javascript" th:src="@{/js/common.js}"></script>
<script type="text/javascript" th:src="@{/js/message.js}"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {

    // ▼ 日付（曜日付き）
    function updateDate() {
        const today = new Date();
        const year = today.getFullYear();
        const month = today.getMonth() + 1;
        const day = today.getDate();
        const week = ["日","月","火","水","木","金","土"];
        const w = week[today.getDay()];
        document.getElementById("today").textContent =
            `${month}月${day}日（${w}）`;
    }

    // ▼ デジタル時間（HH:mm:ss）
    function updateDigitalTime() {
        const now = new Date();
        const h = String(now.getHours()).padStart(2, '0');
        const m = String(now.getMinutes()).padStart(2, '0');
        const s = String(now.getSeconds()).padStart(2, '0');
        document.getElementById("digitalTime").textContent = `${h}:${m}:${s}`;
    }

    // ▼ アナログ時計
    function updateAnalogClock() {
        const now = new Date();
        const seconds = now.getSeconds();
        const minutes = now.getMinutes();
        const hours = now.getHours();

        const secondDeg = seconds * 6;
        const minuteDeg = minutes * 6 + seconds * 0.1;
        const hourDeg   = hours * 30 + minutes * 0.5;

        document.querySelector('.second-hand').style.transform =
            `translateX(-50%) rotate(${secondDeg}deg)`;
        document.querySelector('.minute-hand').style.transform =
            `translateX(-50%) rotate(${minuteDeg}deg)`;
        document.querySelector('.hour-hand').style.transform =
            `translateX(-50%) rotate(${hourDeg}deg)`;
    }

    // ▼ 初回実行
    updateDate();
    updateDigitalTime();
    updateAnalogClock();

    // ▼ 時計類を1秒ごとに更新
    setInterval(() => {
        updateDigitalTime();
        updateAnalogClock();
    }, 1000);
});
</script>
<script th:if="${errorMessage != null}">
	var errorMessage = '[[${errorMessage}]]';
	if(messageArr[errorMessage]){
		alert(messageArr[errorMessage]);
	}else{
		alert('エラーが発生しました')
	}
</script>
<script>
function confirmBreakTime() {
    // promptで入力させる
    var breakTime = prompt("休憩時間を入力してください（例：01:00）");

    // キャンセル or 未入力
    if (breakTime === null || breakTime.trim() === "") {
        alert("休憩時間を入力してください");
        return false; // submit中止
    }

    // hiddenにセット
    document.getElementById("breakTime").value = breakTime;

    return true; // submit続行
}
</script>
<style>
.priority-red {
	color: red;
	font-weight: bold; /* 任意 */
}
</style>
</head>
<body>
	<!-- ▼ 左側固定エリア（ここに日付・時刻・アナログ時計） -->
	<div id="leftArea">
		<div class="userInfo">
			<img th:src="@{/images/{employeeId}.png(employeeId=${employeeID})}"
				alt="写真" />
			<p class="user">
				<span th:text="${employeeName}"></span><br> <span
					th:text="${'(ID : ' + employeeID + ')'	}"></span>
			</p>
		</div>
		<div class="time">
			<div class="share-tech-regular" id="today">--月--日（-）</div>
			<div class="share-tech-regular" id="digitalTime">--:--:--</div>
			<div class="clock">
				<div class="hand hour-hand"></div>
				<div class="hand minute-hand"></div>
				<div class="hand second-hand"></div>
				<div class="center-dot"></div>
			</div>
		</div>
	</div>

	<!-- ▼ ハンバーガメニュー -->
	<div th:insert="menu-fragment :: hamburgerMenu"></div>

	<!-- ▼ メイン画面 -->
	<div id="content">

		<!-- ▼ 打刻 -->
		<div class="attendance">
			<form th:action="@{/kikin/attendance/start}" method="post">
				<button type="submit" name="actionType" value="start"
					class="buttonDesign">出勤</button>
			</form>
			<form th:action="@{/kikin/attendance/end}" method="post"
				onsubmit="return confirmBreakTime();">
				<input type="hidden" name="breakTime" id="breakTime">
				<button type="submit" name="actionType" value="end"
					class="buttonDesign">退勤</button>
			</form>
		</div>
		<!-- ▼ シフト -->
		<div class="todayShift">
			<p>■今日のシフト</p>
			<div th:if="${todayShift != null}">
				<span>勤務時間：</span> <span th:text="${todayShift.startTime}"></span> <span>～</span>
				<span th:text="${todayShift.endTime}"></span>
			</div>
			<div th:if="${todayShift == null}">
				<span th:text="${todayShiftMessage}"></span>
			</div>
		</div>
		<!-- ▼ お知らせ -->
		<div class="news">
			<div class="news-header">
				<p>■お知らせ</p>
				<span th:if="${session.session_cmn_login_user_authority_id == '01'}">
					<a href="/kikin/news" class="news-add">追加</a>
				</span>
			</div>
			<div class="news-table-wrapper">
				<div th:if="${news != null and !#lists.isEmpty(news)}">
					<div class="newsTable"
						style="width: 1200px; margin: 0 auto 10px auto; text-align: left;">
						<table>
							<tr th:each="news, stat : ${news}"
								th:classappend="${#strings.isEmpty(news.newsPriority) == false} ? 'priority-red'">
								<td><span th:text="${stat.count}"></span></td>
								<td><span
									th:text="${#temporals.format(news.updateDatetime, 'yyyy/MM/dd')}"></span></td>
								<td><span th:text="${news.memo}"></span></td>
							</tr>
						</table>
					</div>
				</div>
			</div>
			<div th:if="${news == null or #lists.isEmpty(news)}">
				<span>お知らせはありません。</span>
			</div>
		</div>
	</div>
</body>

</html>
